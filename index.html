<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#f97316">
    <meta name="description" content="Track sunrise, sunset, and daylight hours for Dhaka, Bangladesh">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Daylight Tracker</title>
    <link rel="manifest" href="#" id="manifest-placeholder">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            color: #fff;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 12px;
            animation: slideUp 0.3s ease-out;
        }
        .install-prompt.show {
            display: flex;
        }
        .install-btn {
            background: #f97316;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .install-btn:hover {
            background: #ea580c;
        }
        @keyframes slideUp {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Install Prompt -->
    <div id="install-prompt" class="install-prompt">
        <span>ðŸ“± Install app for offline access</span>
        <button class="install-btn" id="install-btn">Install</button>
        <button class="install-btn" id="dismiss-btn" style="background: #666;">Later</button>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide icons as SVG components
        const Sun = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
        );

        const Sunrise = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 2v8"></path>
                <path d="m4.93 10.93 1.41 1.41"></path>
                <path d="M2 18h2"></path>
                <path d="M20 18h2"></path>
                <path d="m19.07 10.93-1.41 1.41"></path>
                <path d="M22 22H2"></path>
                <path d="m8 6 4-4 4 4"></path>
                <path d="M16 18a4 4 0 0 0-8 0"></path>
            </svg>
        );

        const Sunset = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 10V2"></path>
                <path d="m4.93 10.93 1.41 1.41"></path>
                <path d="M2 18h2"></path>
                <path d="M20 18h2"></path>
                <path d="m19.07 10.93-1.41 1.41"></path>
                <path d="M22 22H2"></path>
                <path d="m16 6-4 4-4-4"></path>
                <path d="M16 18a4 4 0 0 0-8 0"></path>
            </svg>
        );

        const MapPin = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Calendar = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        function SunriseSunsetApp() {
            const [sunData, setSunData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetchSunData();
            }, []);

            const fetchSunData = async () => {
                try {
                    setLoading(true);
                    setError(null);

                    const latitude = 23.8103;
                    const longitude = 90.4125;

                    const response = await fetch(
                        `https://api.sunrisesunset.io/json?lat=${latitude}&lng=${longitude}`
                    );
                    const data = await response.json();

                    if (data.status === "OK") {
                        setSunData({
                            sunrise: data.results.sunrise,
                            sunset: data.results.sunset,
                            dayLength: data.results.day_length,
                            solarNoon: data.results.solar_noon,
                            firstLight: data.results.first_light,
                            lastLight: data.results.last_light,
                            latitude: latitude.toFixed(4),
                            longitude: longitude.toFixed(4),
                            location: "Dhaka, Bangladesh",
                            date: data.results.date,
                        });
                    } else {
                        setError("Failed to fetch sun data");
                    }
                } catch (err) {
                    setError("Unable to fetch data");
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            };

            const calculateDaylight = () => {
                if (!sunData) return null;
                const [hours, minutes] = sunData.dayLength.split(":").map(Number);
                return { hours, minutes, totalMinutes: hours * 60 + minutes };
            };

            const formatTime = (timeString) => {
                return timeString.substring(0, 4) + " " + timeString.substring(8, 10);
            };

            const formateDate = (date) => {
                return new Date(date).toLocaleDateString("en-GB").replace(/\//g, "-");
            };

            const daylight = calculateDaylight();

            return (
                <div className="min-h-screen bg-gradient-to-br from-orange-50 via-amber-50 to-yellow-50 flex items-center justify-center p-4">
                    <div className="w-full max-w-md">
                        <div className="relative" style={{ aspectRatio: "9/19.5" }}>
                            {/* Header */}
                            <div className="flex justify-between items-center my-12">
                                <h1 className="text-3xl font-bold">Daylight</h1>
                                <div className="flex gap-3 items-center">
                                    <p className="text-sm">{sunData?.location.substring(0, 5)}</p>
                                    <MapPin className="w-6 h-6" />
                                </div>
                            </div>

                            {/* Main Display */}
                            <div className="relative flex items-center justify-center mb-12" style={{ height: "45%" }}>
                                <div className="absolute inset-0 flex items-center justify-center">
                                    <div className="w-64 h-64 rounded-full bg-gradient-to-br from-orange-100 to-yellow-100 opacity-30"></div>
                                </div>

                                {loading && (
                                    <div className="text-center z-10">
                                        <Sun className="w-12 h-12 animate-spin mx-auto mb-4 text-orange-500" />
                                        <p className="text-gray-600">Loading...</p>
                                    </div>
                                )}

                                {error && (
                                    <div className="text-center z-10">
                                        <p className="text-red-500 mb-4">{error}</p>
                                        <button
                                            onClick={fetchSunData}
                                            className="px-6 py-2 bg-orange-500 text-white rounded-full hover:bg-orange-600"
                                        >
                                            Retry
                                        </button>
                                    </div>
                                )}

                                {!loading && !error && daylight && (
                                    <div className="text-center z-10">
                                        <div className="text-7xl font-light tracking-wider mb-2 font-mono">
                                            {String(daylight.hours).padStart(2, "0")}H
                                        </div>
                                        <div className="text-7xl font-light tracking-wider font-mono">
                                            {String(daylight.minutes).padStart(2, "0")}M
                                        </div>
                                        <div className="text-sm text-gray-500 mt-4 tracking-widest">
                                            HOURS OF DAYLIGHT
                                        </div>
                                    </div>
                                )}

                                <div className="absolute left-8 top-1/3 w-2 h-2 bg-black rounded-full"></div>
                                <div className="absolute right-8 top-2/3 w-2 h-2 bg-orange-500 rounded-full"></div>
                            </div>

                            {/* Sun Times */}
                            {!loading && !error && sunData && (
                                <div className="space-y-6 px-4">
                                    <div className="flex items-center justify-between p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-2xl">
                                        <div className="flex items-center gap-3">
                                            <div className="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center">
                                                <Sunrise className="w-6 h-6 text-white" />
                                            </div>
                                            <div>
                                                <p className="text-xs text-gray-500 uppercase tracking-wide">Sunrise</p>
                                                <p className="text-2xl font-semibold">{formatTime(sunData.sunrise)}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex items-center justify-between p-4 bg-gradient-to-r from-orange-100 to-red-50 rounded-2xl">
                                        <div className="flex items-center gap-3">
                                            <div className="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center">
                                                <Sunset className="w-6 h-6 text-white" />
                                            </div>
                                            <div>
                                                <p className="text-xs text-gray-500 uppercase tracking-wide">Sunset</p>
                                                <p className="text-2xl font-semibold">{formatTime(sunData.sunset)}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="flex items-center justify-between p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl">
                                        <div className="flex items-center gap-3">
                                            <div className="w-12 h-12 bg-emerald-600 rounded-full flex items-center justify-center">
                                                <Calendar className="w-6 h-6 text-white" />
                                            </div>
                                            <div>
                                                <p className="text-xs text-gray-500 uppercase tracking-wide">Date</p>
                                                <p className="text-2xl font-semibold">{formateDate(sunData.date)}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SunriseSunsetApp />, document.getElementById('root'));
    </script>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'daylight-tracker-v1';
                    const urlsToCache = [
                        '/',
                        'https://unpkg.com/react@18/umd/react.production.min.js',
                        'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js',
                        'https://cdn.tailwindcss.com'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request).then(response => {
                                        if (!response || response.status !== 200 || response.type !== 'basic') {
                                            return response;
                                        }
                                        const responseToCache = response.clone();
                                        caches.open(CACHE_NAME)
                                            .then(cache => {
                                                cache.put(event.request, responseToCache);
                                            });
                                        return response;
                                    });
                                })
                        );
                    });

                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(reg => {
                        console.log('âœ… Service Worker registered successfully');
                    })
                    .catch(err => {
                        console.log('âŒ Service Worker registration failed:', err);
                    });
            });
        }

        // Web App Manifest
        const manifest = {
            "name": "Daylight Tracker - Dhaka",
            "short_name": "Daylight",
            "description": "Track sunrise, sunset, and daylight hours for Dhaka, Bangladesh",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#f97316",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f97316;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23ea580c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%23fef3c7'/%3E%3Cline x1='50' y1='10' x2='50' y2='20' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='50' y1='80' x2='50' y2='90' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='10' y1='50' x2='20' y2='50' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='80' y1='50' x2='90' y2='50' stroke='%23fef3c7' stroke-width='3'/%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                },
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%23f97316;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23ea580c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)'/%3E%3Ccircle cx='50' cy='50' r='20' fill='%23fef3c7'/%3E%3Cline x1='50' y1='10' x2='50' y2='20' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='50' y1='80' x2='50' y2='90' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='10' y1='50' x2='20' y2='50' stroke='%23fef3c7' stroke-width='3'/%3E%3Cline x1='80' y1='50' x2='90' y2='50' stroke='%23fef3c7' stroke-width='3'/%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('install-prompt');
        const installBtn = document.getElementById('install-btn');
        const dismissBtn = document.getElementById('dismiss-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            setTimeout(() => {
                installPrompt.classList.add('show');
            }, 3000);
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                installPrompt.classList.remove('show');
            }
        });

        dismissBtn.addEventListener('click', () => {
            installPrompt.classList.remove('show');
        });

        window.addEventListener('appinstalled', () => {
            console.log('âœ… PWA installed successfully');
            installPrompt.classList.remove('show');
        });

        if (window.matchMedia('(display-mode: standalone)').matches) {
            console.log('âœ… App is running in standalone mode');
        }
    </script>
</body>
</html>